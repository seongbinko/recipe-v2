<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seongbindb.recipe.mapper.UserMapper">

    <insert id="insertUser" parameterType="com.seongbindb.recipe.vo.User">
        insert into recipe_user (user_id, user_password, user_nickname, user_email, user_email_token, user_email_verified)
        values (#{id}, #{password}, #{nickname}, #{email}, #{emailCheckToken}, #{emailVerified})
    </insert>

    <select id="existByEmail" parameterType="string" resultType="boolean">
        select
               case when exists(
                           SELECT 1
                           FROM recipe_user
                           WHERE user_email = #{email}
               		   )
			   then 'true'
			   else 'false'
			   end
    </select>

    <select id="existByNickName" parameterType="string" resultType="boolean">
		select
			case when exists(
					SELECT 1
					FROM recipe_user
					WHERE user_nickname = #{nickname}
				)
					 then 'true'
				 else 'false'
				end
    </select>

    <select id="findByEmail" parameterType="string" resultType="com.seongbindb.recipe.vo.User">
        select
            user_id as id,
            user_password as password,
            user_nickname as nickname,
            user_createdate as createDate,
            user_moddate as modDate,
            user_email as email,
            user_role as role,
            user_email_token as emailCheckToken,
            user_email_verified as emailVerified
        from
            recipe_user
        where
            user_email = #{value}
    </select>

    <select id="countAllUser" resultType="int">
        select count(*)
        from recipe_user
    </select>
    <update id="updateEmailVerified" parameterType="com.seongbindb.recipe.vo.User">
        update
            recipe_user
        set
            user_email_verified = #{emailVerified}
        where user_email = #{email}
    </update>
</mapper>